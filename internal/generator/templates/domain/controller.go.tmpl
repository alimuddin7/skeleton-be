package controllers

import (
	"{{.ProjectName}}/dto"
	"{{.ProjectName}}/helpers"
	"{{.ProjectName}}/models"
	{{if .IsCRUD}}
	"{{.ProjectName}}/usecases/v1"
	"strconv"
	{{end}}

	"github.com/gofiber/fiber/v3"
)

{{if .IsCRUD}}
type {{.FeatureName}}Controller interface {
	Create(c fiber.Ctx) error
	Get(c fiber.Ctx) error
	List(c fiber.Ctx) error
	Update(c fiber.Ctx) error
	Delete(c fiber.Ctx) error
}

type {{.FeatureNameLower}}Controller struct {
	usecase usecases.{{.FeatureName}}Usecase
}

func New{{.FeatureName}}Controller(u usecases.{{.FeatureName}}Usecase) {{.FeatureName}}Controller {
	return &{{.FeatureNameLower}}Controller{
		usecase: u,
	}
}

func (ctr *{{.FeatureNameLower}}Controller) Create(c fiber.Ctx) error {
	var req models.{{.FeatureName}}
	if err := c.Bind().Body(&req); err != nil {
		return helpers.ResponseFormatter(c, err, "", 0, nil, nil)
	}

	res, err := ctr.usecase.Create(c.Context(), &req)
	return helpers.ResponseFormatter(c, err, "", res.Count, res.Page, res.Data)
}

func (ctr *{{.FeatureNameLower}}Controller) Get(c fiber.Ctx) error {
	id, err := strconv.Atoi(c.Params("id"))
	if err != nil {
		return helpers.ResponseFormatter(c, err, "", 0, nil, nil)
	}

	res, err := ctr.usecase.Get(c.Context(), id)
	return helpers.ResponseFormatter(c, err, "", res.Count, res.Page, res.Data)
}

func (ctr *{{.FeatureNameLower}}Controller) List(c fiber.Ctx) error {
	page := c.QueryInt("page", 1)
	limit := c.QueryInt("limit", 10)

	res, err := ctr.usecase.List(c.Context(), page, limit)
	return helpers.ResponseFormatter(c, err, "", res.Count, res.Page, res.Data)
}

func (ctr *{{.FeatureNameLower}}Controller) Update(c fiber.Ctx) error {
	id, err := strconv.Atoi(c.Params("id"))
	if err != nil {
		return helpers.ResponseFormatter(c, err, "", 0, nil, nil)
	}

	var req models.{{.FeatureName}}
	if err := c.Bind().Body(&req); err != nil {
		return helpers.ResponseFormatter(c, err, "", 0, nil, nil)
	}

	res, err := ctr.usecase.Update(c.Context(), id, &req)
	return helpers.ResponseFormatter(c, err, "", res.Count, res.Page, res.Data)
}

func (ctr *{{.FeatureNameLower}}Controller) Delete(c fiber.Ctx) error {
	id, err := strconv.Atoi(c.Params("id"))
	if err != nil {
		return helpers.ResponseFormatter(c, err, "", 0, nil, nil)
	}

	res, err := ctr.usecase.Delete(c.Context(), id)
	return helpers.ResponseFormatter(c, err, "", res.Count, res.Page, res.Data)
}
{{else}}
// {{.FeatureName}} godoc
// @Summary {{.FeatureName}}
// @Description {{.FeatureName}} endpoint
// @Tags {{.FeatureNameLower}}
// @ID {{.FeatureNameLower}}
// @Produce json
// @Success 200 {object} dto.Response
// @Router /v1/{{.FeatureNameLower}} [GET]
func (ctrl *v1Controller) {{.FeatureName}}(c fiber.Ctx) error {
	res, err := ctrl.Usecase.{{.FeatureName}}(c.Context())
	return helpers.ResponseFormatter(c, err, "", res.Count, res.Page, res.Data)
}
{{end}}
