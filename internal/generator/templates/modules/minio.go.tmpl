package minio

import (
	"{{.ProjectName}}/configs"
	"github.com/minio/minio-go/v7"
	"github.com/minio/minio-go/v7/pkg/credentials"
	"github.com/rs/zerolog"
)

type (
	minioRepository struct {
		Client *minio.Client
		Logs   zerolog.Logger
	}
	MinioRepository interface {
		GetClient() *minio.Client
	}
)

func InitializeMinioRepository(client *minio.Client, log zerolog.Logger) MinioRepository {
	return &minioRepository{
		Client: client,
		Logs:   log,
	}
}

func ConnectMinio(log zerolog.Logger) *minio.Client {
	conf := configs.Cfg.Database.Minio
	client, err := minio.New(conf.Endpoint, &minio.Options{
		Creds:  credentials.NewStaticV4(conf.KeyID, conf.Secret, ""),
		Secure: true,
	})
	if err != nil {
		log.Error().Err(err).Msg("Error open minio connection")
		panic(err)
	}
	log.Info().Msg("Minio connected successfully")
	return client
}

func (m *minioRepository) GetClient() *minio.Client {
	return m.Client
}
