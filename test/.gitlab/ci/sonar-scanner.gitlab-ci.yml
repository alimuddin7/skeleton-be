###############################################
#                Sonar scanner                #
###############################################

.sonar-scanner:
  stage: sonar-scanner
  only:
    refs:
      - merge_requests
    variables:
      - $CI_PIPELINE_SOURCE == 'merge_request_event'

sonar-scanner:
  extends:
    - .sonar-scanner
  script:
    - docker run --rm --add-host "sonar.ottodigital.id:10.10.21.13" -e SONAR_HOST_URL="https://sonar.ottodigital.id/" -e SONAR_SCANNER_OPTS="-Dsonar.projectKey=$CI_PROJECT_NAME -Dsonar.projectName=$CI_PROJECT_NAME -Dsonar.language=go -Dsonar.projectVersion=1.0 -Dsonar.sources=. -Dsonar.analysis.mode=publish -Dsonar.projectBaseDir=. -Dsonar.qualitygate.wait=true" -e SONAR_TOKEN="sqa_cfb5bd817f768ae1ef5f1804f20d4ef133896b3e" -v "${PWD}:/usr/src" sonarsource/sonar-scanner-cli
